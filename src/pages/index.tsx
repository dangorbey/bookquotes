import Head from "next/head";
// import Link from "next/link";
import { useRef, useState } from "react";
// import html2canvas from 'html2canvas';
import * as htmlToImage from 'html-to-image';

export default function Home() {
  const [textValue, setTextValue] = useState<string>('');

  // Handle input change
  const handleInputChange = (event: React.ChangeEvent<HTMLTextAreaElement>): void => {
    setTextValue(event.target.value);
  };

  // Function to process the text value
  const processTextValue = () => {
    const regex = /\*\*(.*?)\*\*/g;
    let processed = textValue.replace(regex, (_, matchedText) => `<span class="highlight">${matchedText}</span>`);
    processed = processed.replace(/\n/g, '<br />');
    return processed;
  };

  const processedValue = processTextValue();

  // Handle PNG export
  const divRef = useRef<HTMLDivElement>(null);

  const handleExport = () => {
    if (divRef.current) {
      htmlToImage.toPng(divRef.current)
        .then((dataUrl) => {
          const link = document.createElement('a');
          link.href = dataUrl;
          link.download = "Quote_" + getFilenameFromInput();
          link.click();
        })
        .catch((error) => {
          console.error('Error exporting to PNG:', error);
        });
    }
  };

  // genrate file name
  const getFilenameFromInput = (): string => {
    const inputValue = textValue.trim() || "default_name";
    const words = inputValue.split(" ").slice(0, 3).join("_");
    const sanitizedFilename = words.replace(/[^a-zA-Z0-9_]/g, "");
    return `${sanitizedFilename}.png`;
  }


  return (
    <>
      <Head>
        <title>Create a Quote!</title>
        {/* <link href="https://use.typekit.net/fhn2cew.css" rel="stylesheet" /> */}
        {/* <link rel="stylesheet" href="https://use.typekit.net/fhn2cew.css"></link> */}
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="flex min-h-screen flex-col items-center justify-center">
        <div className="container flex flex-col items-center justify-center p-4">
          {/* <div className="md:max-w-2xl"> */}
          <h1 className="text-xl font-bold">Quote Generator: </h1>
          <div className="h-4"></div>
          <div ref={divRef} className="border-amber-100 border-2 bg-white w-80 aspect-[4/5] p-8 flex flex-col items-center justify-center">
            <div className="w-full break-normal" dangerouslySetInnerHTML={{ __html: processedValue }}></div>
          </div>
          <div className="h-4"></div>

          <button className="font-bold p-2 bg-amber-100" onClick={handleExport}>Export to PNG</button>
          <div className="h-2"></div>
          <div className="w-80">
            <div className=" py-2">
              <p className="font-bold">Paste quote below:</p>
              <p>Text within <span className="highlight">**two asterisks**</span> will be highlighted.</p>
            </div>
            {/* <textarea className="border-amber-100 border-2 w-full p-4"></textarea> */}
            {/* Render the input */}
            <textarea
              className="border-amber-100 border-2 w-full p-4"
              value={textValue}
              onChange={handleInputChange}
              placeholder="Your quote here..."
            />

          </div>
        </div>
      </main >
    </>
  );
}
